<!DOCTYPE html>
<html lang="en">
<head>
  <title>UTD Mart</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="mystyle.css">
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

  
</head>
<body>
  <header>
    <h2>UTD Mart</h2>
    <p align="left" id="date"></p>
  </header>
  
  <div class="topnav">
    <a href="Fresh_Products.html">Fresh Products</a>
    <a href="Frozen.html">Frozen</a>
    <a href="Pantry.html">Pantry</a>
    <a href="BreakfastandCereal.html">Breakfast & Cereal</a>
    <a href="Baking.html">Baking</a>
    <a class="active" href="Snacks.html">Snacks</a>
    <a href="Candy.html">Candy</a>
    <a href="Specialty_shop.html">Specialty Shop</a>
    <a href="Deals.html">Deals</a>
    <a href="My_account.html">My Account</a>
    <a href="About_us.html">About us</a>
    <a href="Contact_us.html">Contact Us</a>
    <a href="cart.html">
      <i class="fa fa-shopping-cart"></i> Cart
    </a>
  </div>

  <section>

    <nav>
      <ul>
        <img src="snacks.jpg" alt="Frozen" width="90%" height="240" padding-right="10">
        <br/>
        <br/>
      <li>Potato Chips</li>
      <li>Chocolate Bars</li>
      <li>Popcorn</li>
      <li>Granola Bars</li>
      <li>Mixed Nuts</li>
      <li>Cheese Puffs</li>
      <!-- <li>Fruit Bars</li>
      <li>Gummy Candy</li>
      <li>Hummus with Veggie Sticks</li>
      <li>Trail Mix</li>
      <li>Pretzels</li>
      <li>Salsa with Tortilla Chips</li>
      <li>Peanut Butter with Apple Slices</li>
      <li>Beef Jerky</li>
      <li>Rice Cakes</li> -->
      </ul>
    </nav>


    <article>
      <div align="center">
      <h2 >Snacks</h2>
      <input type="text" id="snackSearch" placeholder="Enter Snack Name" oninput="filterSnacks()">
      <p id="error" style="color: red;"></p>
      </div>
      
      <!-- Snack grid view will be displayed here -->


      <div id="product-grid" class="product-grid">



        <!-- <div class="product-item" data-category="Potato Chips">
          <img src="Snacks/Potatochips.jpeg" alt="lays">
          <strong><p>Lays Potato Chips</p></strong>
          <p>Price: $2.99</p>
          <label for="snackQuantity">Quantity:</label>
          <input type="number" id="snackQuantity_Lays" placeholder="Enter Quantity">
          <button onclick="addToCart('Lays', 2.99, 'Potato Chips', 'snackQuantity_Lays')">Add to Cart</button>
        </div>


       
        <div class="product-item" data-category="Potato Chips">
          <img src="Snacks/Potatochips2.jpg" alt="marketpantry">
          <strong><p>Naturally Flavored Cheddar And Sour Cream Ripple Potato Chips</p></strong>
          <p>Price: $2.99</p>
          <label for="snackQuantity">Quantity:</label>
          <input type="number" id="snackQuantity_marketpantry" placeholder="Enter Quantity">
          <button onclick="addToCart('marketpantry', 2.99, 'Potato Chips', 'snackQuantity_marketpantry')">Add to Cart</button>
        </div>


        <div class="product-item" data-category="Potato Chips">
          <img src="Snacks/ruffles.jpg" alt="ruffles">
          <strong><p>Ruffles Potato Chips Original 13 Oz</p></strong>
          <p>Price: $2.99</p>
          <label for="snackQuantity">Quantity:</label>
          <input type="number" id="snackQuantity_ruffles" placeholder="Enter Quantity">
          <button onclick="addToCart('ruffles', 2.99, 'Potato Chips','snackQuantity_ruffles')">Add to Cart</button>
        </div>



        
        <div class="product-item" data-category="Chocolate bars">
          <img src="Snacks/chocolatebars.jpg" alt="chocolatebars">
          <strong><p>Chocolate bars blueberry</p></strong>
          <p>Price: $5.99</p>
          <label for="snackQuantity">Quantity:</label>
          <input type="number" id="snackQuantity_chocolatebars" placeholder="Enter Quantity">
          <button onclick="addToCart('chocolatebars', 2.99, 'Chocolate bars','snackQuantity_chocolatebars')">Add to Cart</button>
        </div>


        <div class="product-item" data-category="Chocolate bars">
          <img src="Snacks/red.jpg" alt="red">
          <strong><p>Red Dark Chocolate bar</p></strong>
          <p>Price: $4.99</p>
          <label for="snackQuantity">Quantity:</label>
          <input type="number" id="snackQuantity_red" placeholder="Enter Quantity">
          <button onclick="addToCart('red', 4.99, 'Chocolate bars','snackQuantity_red')">Add to Cart</button>
        </div>

        <div class="product-item" data-category="Chocolate bars">
          <img src="Snacks/milka.jpg" alt="milka">
          <strong><p>Milka Cherry Creme Milk Chocolate Bar</p></strong>
          <p>Price: $3.99</p>
          <label for="snackQuantity">Quantity:</label>
          <input type="number" id="snackQuantity_milka" placeholder="Enter Quantity">
          <button onclick="addToCart('milka', 3.99, 'Chocolate bars','snackQuantity_milka')">Add to Cart</button>
        </div>




       
        <div class="product-item" data-categosry="Popcorn">
          <img src="Snacks/popcorn.jpg" alt="marketpantry">
          <strong><p>Extra Butter Popcorn (24-Pack)</p></strong>
          <p>Price: $5.99</p>
          <label for="snackQuantity">Quantity:</label>
          <input type="number" id="snackQuantity_popcorn1" placeholder="Enter Quantity">
          <button onclick="addToCart('ExtraButterPopcorn', 5.99, 'Popcorn', 'snackQuantity_popcorn1')">Add to Cart</button>
        </div>


        <div class="product-item" data-categosry="Popcorn">
          <img src="Snacks/popcorn2.jpg" alt="Centralmarket">
          <strong><p>Central Market Movie Theater Popcorn</p></strong>
          <p>Price: $6.99</p>
          <label for="snackQuantity">Quantity:</label>
          <input type="number" id="snackQuantity_popcorn2" placeholder="Enter Quantity">
          <button onclick="addToCart('Central_Market_MoviePopcorn', 5.99, 'Popcorn', 'snackQuantity_popcorn2')">Add to Cart</button>
        </div>


        <div class="product-item" data-categosry="Popcorn">
          <img src="Snacks/popcorn3.jpg" alt="DDM">
          <strong><p>DDM NATURAL POPCORN</p></strong>
          <p>Price: $5.99</p>
          <label for="snackQuantity">Quantity:</label>
          <input type="number" id="snackQuantity_popcorn3" placeholder="Enter Quantity">
          <button onclick="addToCart('DDM_Natural_Popcorn', 5.99, 'Popcorn', 'snackQuantity_popcorn3')">Add to Cart</button>
        </div>



        <div class="product-item" data-categosry="Granola-bar">
          <img src="Snacks/granola3.jpg" alt="wellsey">
          <strong><p>Wellsley Farms Chewy Chocolate Chip Granola Bars</p></strong>
          <p>Price: $5.99</p>
          <label for="snackQuantity">Quantity:</label>
          <input type="number" id="snackQuantity_granola3" placeholder="Enter Quantity">
          <button onclick="addToCart('wellsey_granola bar ', 5.99, 'Granola-bar', 'snackQuantity_granola3')">Add to Cart</button>
        </div>


        <div class="product-item" data-categosry="Granola-bar">
          <img src="Snacks/granola2.jpg" alt="Nature valley">
          <strong><p>Sweet and Salty Almond Granola Bar | Nature Valley</p></strong>
          <p>Price: $5.99</p>
          <label for="snackQuantity">Quantity:</label>
          <input type="number" id="snackQuantity_granola2" placeholder="Enter Quantity">
          <button onclick="addToCart('Nature_Valley_Sweet_and_Salty', 5.99, 'Granola-bar', 'snackQuantity_granola2')">Add to Cart</button>
        </div>





        <div class="product-item" data-categosry="nuts">
          <img src="Snacks/nuts1.jpg" alt="signaturemixednuts">
          <strong><p>Kirkland Signature Extra Fancy Mixed Nuts</p></strong>
          <p>Price: $7.99</p>
          <label for="snackQuantity">Quantity:</label>
          <input type="number" id="snackQuantity_nuts1" placeholder="Enter Quantity">
          <button onclick="addToCart('Signature_Mixed_nuts ', 5.99, 'nuts', 'snackQuantity_nuts1')">Add to Cart</button>
        </div>


        <div class="product-item" data-categosry="nuts">
          <img src="Snacks/nuts2.jpg" alt="planters">
          <strong><p>Planters Deluxe Lightly Salted Mixed Nuts-15.25oz </p></strong>
          <p>Price: $8.99</p>
          <label for="snackQuantity">Quantity:</label>
          <input type="number" id="snackQuantity_nuts2" placeholder="Enter Quantity">
          <button onclick="addToCart('planters_Mixed_nuts ', 8.99, 'nuts', 'snackQuantity_nuts2')">Add to Cart</button>
        </div>


       
        <div class="product-item" data-categosry="cheese_puff">
          <img src="Snacks/puffs1.jpg" alt="cheetos">
          <strong><p>CHEETOS Snacks Cheese Flavored Puffs - 8 Oz </p></strong>
          <p>Price: $2.99</p>
          <label for="snackQuantity">Quantity:</label>
          <input type="number" id="snackQuantity_puffs1" placeholder="Enter Quantity">
          <button onclick="addToCart('Cheetos', 8.99, 'cheese_puff', 'snackQuantity_puffs1')">Add to Cart</button>
        </div>


        <div class="product-item" data-categosry="cheese_puff">
          <img src="Snacks/puffs2.jpg" alt="cheetos">
          <strong><p>Good HealthÂ® Organic Baked Puffs Mac & Cheese 5.25 oz </p></strong>
          <p>Price: $3.99</p>
          <label for="snackQuantity">Quantity:</label>
          <input type="number" id="snackQuantity_puffs2" placeholder="Enter Quantity">
          <button onclick="addToCart('good_health_puffs', 8.99, 'cheese_puff', 'snackQuantity_puffs2')">Add to Cart</button>
        </div> -->
      

        <!-- Add more snack items here -->
      </div>
    </article>
  </section>

  <footer>
    <p align="left">DMK220001, Denish Kalariya, CS6314.001</p>
    <p>Thank you for Visiting my website</p>
  </footer>

  <script>
    // Get the current date and time

    
    // Function to add snack to the cart (You can implement your cart logic here)
    // function addToCart(snackName, snackPrice, snackCategory) {
    //   // Get the quantity input value
    //   var quantityInput = document.getElementById("snackQuantity");
    //   var quantity = parseInt(quantityInput.value, 10);
  
    //   if (isNaN(quantity) || quantity <= 0) {
    //     document.getElementById("error").textContent = "Please enter a valid quantity.";
    //   } else {
    //     document.getElementById("error").textContent = "";
    //     // Implement cart logic here
    //   }
    // }

  
  // function addToCart(itemName, itemPrice, itemCategory) {
  // // Check if the item is in stock
  // if (inventory[itemName] === undefined || inventory[itemName] === 0) {
  //   alert(itemName + " is out of stock.");
  //   return; // Don't add the item to the cart if it's out of stock
  // }

  // // Get the quantity input value
  // var quantityInput = document.getElementById("snackQuantity");
  // var quantity = parseInt(quantityInput.value, 10);

  // if (isNaN(quantity) || quantity <= 0) {
  //   alert("Please enter a valid quantity.");
  //   return; // Don't add the item to the cart if the quantity is invalid
  // }


var productData = ""; // Empty string for now
var inventoryData = ""; // Empty string for now
var products;
var inventory;
// var cart = {};
function initializeCart() {
  try {
    var cartData = localStorage.getItem('cart');
    return cartData ? JSON.parse(cartData) : {}; // Provide a default empty object if cartData is undefined
  } catch (error) {
    console.error('Error parsing cart data from local storage:', error);
    return {}; // Provide a default empty object in case of errors
  }
}
// Fetch existing cart data from local storage
var cart = initializeCart(); // Call the function to initialize cart data



  // function initializeCart() {
  //     try {
  //       var cartData = localStorage.getItem('cart');
  //       return cartData ? JSON.parse(cartData) : {}; // Provide a default empty object if cartData is undefined
  //     } catch (error) {
  //       console.error('Error parsing cart data from local storage:', error);
  //       return {}; // Provide a default empty object in case of errors
  //     }
  //   }

  //   var cart = initializeCart();



///


function updateDateTime() {
  const now = new Date();
  const currentDateTime = now.toLocaleString();
  $('#date').html(currentDateTime);
}

setInterval(updateDateTime, 1000);

  fetch("Snacks_products.xml")
  .then((response) => response.text())
  .then((data) => {
    productData = data;
    initializeData();
  })
  .catch((error) => console.error("Error fetching product data:", error));

console.log(productData);

// Fetch inventory data from the XML file
fetch("Snacks_Inventory.xml")
  .then((response) => response.text())
  .then((data) => {
    inventoryData = data;
    initializeData();
  })
  .catch((error) => console.error("Error fetching inventory data:", error));
  console.log(productData);


  function initializeData() {
  console.log("Product Data:", productData);
  console.log("Inventory Data:", inventoryData);

  if (productData && inventoryData) {
    var parser = new DOMParser();

    // Parse product data
    var productXmlDoc = parser.parseFromString(productData, "text/xml");
    if (!productXmlDoc) {
      console.error("Error parsing product data XML:", productData);
      return;
    }
    products = productXmlDoc.querySelectorAll("product");

    // Parse inventory data
    var inventoryXmlDoc = parser.parseFromString(inventoryData, "text/xml");
    if (!inventoryXmlDoc) {
      console.error("Error parsing inventory data XML:", inventoryData);
      return;
    }
    inventory = {};
    var inventoryProducts = inventoryXmlDoc.querySelectorAll("product");

    for (var i = 0; i < inventoryProducts.length; i++) {
      var productName = inventoryProducts[i].getAttribute("name");
      var productQuantity = parseInt(inventoryProducts[i].getAttribute("quantity"), 10);
      inventory[productName] = productQuantity;
    }
    console.log("Inventory:", inventory);

    // Call the function to create product cards after data is initialized
    createProductCards('all');
  }
}



function createProductCards(category) {
  const productGrid = document.getElementById('product-grid');
  productGrid.innerHTML = ''; // Clear existing products

  for (let i = 0; i < products.length; i++) {
    const product = products[i];
    const productCategory = product.querySelector('category').textContent;

    if (category === 'all' || productCategory === category) {
      const productName = product.querySelector('name').textContent;
      const productPrice = parseFloat(product.querySelector('price').textContent);
      const productQuantityInputId = `snackQuantity_${productName.replace(/ /g, '_')}`;

      const productItem = document.createElement('div');
      productItem.classList.add('product-item');
      productItem.setAttribute('data-category', productCategory);

      productItem.innerHTML = `
        <img src="${product.querySelector('image').textContent}" alt="${productName}">
        <strong><p>${productName}</p></strong>
        <p>Price: $${productPrice.toFixed(2)}</p>
        <label for="${productQuantityInputId}">Quantity:</label>
        <input type="number" id="${productQuantityInputId}" placeholder="Enter Quantity">
        <button onclick="addToCart('${productName}', ${productPrice}, '${productCategory}', '${productQuantityInputId}')">Add to Cart</button>
      `;

      productGrid.appendChild(productItem);
    }
  }
}


    document.querySelectorAll('.category-navigation a').forEach(function(link) {
  link.addEventListener('click', function(event) {
    event.preventDefault();
    const selectedCategory = link.getAttribute('data-category');
    document.getElementById('article-heading').textContent = selectedCategory === 'all' ? 'All Products' : selectedCategory;
    createProductCards(selectedCategory);
  });
});

// Initialize with 'All Products' when the page loads
document.getElementById('article-heading').textContent = 'All Products';
createProductCards('all');

console.log(productData);
console.log(inventoryData);


    function updateInventory(itemName, quantity) {
  const modifiedItemName = itemName.replace(/ /g, '_');
  if (inventory[modifiedItemName] !== undefined) {
    inventory[modifiedItemName] -= quantity;
  }
}


function addToCart(itemName, itemPrice, itemCategory, quantityInputId) {
  var quantityInput = $('#' + quantityInputId);
  var quantity = parseInt(quantityInput.val(), 10);

  const modifiedItemName = itemName.replace(/ /g, '_');

  if (isNaN(quantity) || quantity <= 0) {
    $('#error').text('Please enter a valid quantity.');
  } else if (inventory[modifiedItemName] !== undefined && quantity > inventory[modifiedItemName]) {
    $('#error').text('Not enough quantity in inventory, Out of Stock.');
  } else {
    $('#error').text('');

    if (!cart[modifiedItemName]) {
      cart[modifiedItemName] = {
        price: itemPrice,
        category: itemCategory,
        quantity: quantity,
        source : 'Snacks_Inventory.xml'
      };
    } else {
      cart[modifiedItemName].quantity += quantity;
    }

    // Update the inventory
    updateInventory(itemName, quantity);

    // Update the local storage
    localStorage.setItem('cart', JSON.stringify(cart));
    alert(itemName + ' added to cart!');
    console.log(inventory);



    //Update
    const xhr = new XMLHttpRequest();
    xhr.onreadystatechange = function () {
      if (xhr.readyState == 4 && xhr.status == 200) {
        // Handle the response from the server, if needed
        console.log(xhr.responseText);
      }
    };

    // const data = `itemName=${encodeURIComponent(itemName)}&itemPrice=${encodeURIComponent(itemPrice)}&itemCategory=${encodeURIComponent(itemCategory)}&quantity=${encodeURIComponent(quantity)}`;
    // xhr.open('POST', 'Snacks.php', true);
    // xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    // xhr.send(data); 

    // console.log(data);
    // const itemQuantity = 1;
  // Prepare data to send to the PHP file
  const data = `itemName=${encodeURIComponent(itemName)}&itemPrice=${encodeURIComponent(itemPrice)}&itemCategory=${encodeURIComponent(itemCategory)}&itemQuantity=${encodeURIComponent(quantity)}`;
  console.log(data);
  // xhr.open('POST', 'fresh.php', true);
  xhr.open('POST', 'update_cart.php', true)
  // xhr.open('POST', 'fresh_inventorydb.php', true)
  xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
  console.log(data);
  xhr.send(data);


  }
}


function filterSnacks() {
  var searchInput = document.getElementById("snackSearch").value.toLowerCase();
  var snackItems = document.querySelectorAll(".product-item");
  var errorElement = document.getElementById("error");

  if (!isNaN(searchInput) && searchInput.trim() !== "") {
    errorElement.textContent = "Please enter a valid snack name, not a number.";
  } else {
    errorElement.textContent = "";

    snackItems.forEach(function (item) {
      // Check if the element with the given tag name exists in the item
      var strongElement = item.getElementsByTagName("strong")[0];
      if (strongElement) {
        var snackName = strongElement.textContent.toLowerCase();
        if (snackName.includes(searchInput)) {
          item.style.display = "block";
        } else {
          item.style.display = "none";
        }
      }
    });
  }
}
  </script>
</body>
</html>
